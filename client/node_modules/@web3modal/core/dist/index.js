import{proxy as u,subscribe as f}from"valtio/vanilla";import{Buffer as U}from"buffer";let L;const p={ethereumClient:void 0,setEthereumClient(e){L=e},client(){if(L)return L;throw new Error("ClientCtrl has no client set")}},o=u({address:void 0,profileName:void 0,profileAvatar:void 0,profileLoading:!1,balanceLoading:!1,balance:void 0,isConnected:!1}),A={state:o,subscribe(e){return f(o,()=>e(o))},getAccount(){const e=p.client().getAccount();o.address=e.address,o.isConnected=e.isConnected},async fetchProfile(e,t){try{o.profileLoading=!0;const n=t??o.address,{id:a}=p.client().getDefaultChain();if(n&&a===1){const[l,c]=await Promise.all([p.client().fetchEnsName({address:n,chainId:1}),p.client().fetchEnsAvatar({address:n,chainId:1})]);c&&await e(c),o.profileName=l,o.profileAvatar=c}}finally{o.profileLoading=!1}},async fetchBalance(e){try{o.balanceLoading=!0;const t=e??o.address;if(t){const n=await p.client().fetchBalance({address:t});o.balance={amount:n.formatted,symbol:n.symbol}}}finally{o.balanceLoading=!1}},setAddress(e){o.address=e},setIsConnected(e){o.isConnected=e},resetBalance(){o.balance=void 0},resetAccount(){o.address=void 0,o.isConnected=!1,o.profileName=void 0,o.profileAvatar=void 0,o.balance=void 0}},d={WALLETCONNECT_DEEPLINK_CHOICE:"WALLETCONNECT_DEEPLINK_CHOICE",W3M_VERSION:"W3M_VERSION",isMobile(){return typeof window<"u"?!!(window.matchMedia("(pointer:coarse)").matches||/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini/u.test(navigator.userAgent)):!1},isAndroid(){return d.isMobile()&&navigator.userAgent.toLowerCase().includes("android")},isEmptyObject(e){return Object.getPrototypeOf(e)===Object.prototype&&Object.getOwnPropertyNames(e).length===0&&Object.getOwnPropertySymbols(e).length===0},isHttpUrl(e){return e.startsWith("http://")||e.startsWith("https://")},formatNativeUrl(e,t,n){if(d.isHttpUrl(e))return this.formatUniversalUrl(e,t,n);let a=e;a.includes("://")||(a=e.replaceAll("/","").replaceAll(":",""),a=`${a}://`),this.setWalletConnectDeepLink(a,n);const l=encodeURIComponent(t);return`${a}wc?uri=${l}`},formatUniversalUrl(e,t,n){if(!d.isHttpUrl(e))return this.formatNativeUrl(e,t,n);let a=e;e.endsWith("/")&&(a=e.slice(0,-1)),this.setWalletConnectDeepLink(a,n);const l=encodeURIComponent(t);return`${a}/wc?uri=${l}`},async wait(e){return new Promise(t=>{setTimeout(t,e)})},openHref(e,t){window.open(e,t,"noreferrer noopener")},setWalletConnectDeepLink(e,t){localStorage.setItem(d.WALLETCONNECT_DEEPLINK_CHOICE,JSON.stringify({href:e,name:t}))},setWalletConnectAndroidDeepLink(e){const[t]=e.split("?");localStorage.setItem(d.WALLETCONNECT_DEEPLINK_CHOICE,JSON.stringify({href:t,name:"Android"}))},removeWalletConnectDeepLink(){localStorage.removeItem(d.WALLETCONNECT_DEEPLINK_CHOICE)},isNull(e){return e===null},setWeb3ModalVersionInStorage(){typeof localStorage<"u"&&localStorage.setItem(d.W3M_VERSION,"2.2.2")}},s=u({selectedChain:void 0,chains:void 0,standaloneChains:void 0,standaloneUri:void 0,isStandalone:!1,isCustomDesktop:!1,isCustomMobile:!1,isDataLoaded:!1,isUiLoaded:!1,walletConnectVersion:1}),i={state:s,subscribe(e){return f(s,()=>e(s))},setChains(e){s.chains=e},setStandaloneChains(e){s.standaloneChains=e},setStandaloneUri(e){s.standaloneUri=e},getSelectedChain(){const e=p.client().getNetwork().chain;return e&&(s.selectedChain=e),s.selectedChain},setSelectedChain(e){s.selectedChain=e},setIsStandalone(e){s.isStandalone=e},setIsCustomDesktop(e){s.isCustomDesktop=e},setIsCustomMobile(e){s.isCustomMobile=e},setIsDataLoaded(e){s.isDataLoaded=e},setIsUiLoaded(e){s.isUiLoaded=e},setWalletConnectVersion(e){s.walletConnectVersion=e}},b=u({projectId:"",mobileWallets:void 0,desktopWallets:void 0,walletImages:void 0,chainImages:void 0,tokenImages:void 0,standaloneChains:void 0,enableStandaloneMode:!1,enableNetworkView:!1,enableAccountView:!0,enableExplorer:!0,defaultChain:void 0,explorerAllowList:void 0,explorerDenyList:void 0,termsOfServiceUrl:void 0,privacyPolicyUrl:void 0}),S={state:b,subscribe(e){return f(b,()=>e(b))},setConfig(e){var t,n,a,l;if(i.setStandaloneChains(e.standaloneChains),i.setIsStandalone(!!((t=e.standaloneChains)!=null&&t.length)||!!e.enableStandaloneMode),i.setIsCustomMobile(!!((n=e.mobileWallets)!=null&&n.length)),i.setIsCustomDesktop(!!((a=e.desktopWallets)!=null&&a.length)),i.setWalletConnectVersion((l=e.walletConnectVersion)!=null?l:1),!i.state.isStandalone){const c=p.client().getDefaultChain();i.setSelectedChain(c),i.setChains(p.client().chains)}e.defaultChain&&i.setSelectedChain(e.defaultChain),d.setWeb3ModalVersionInStorage(),Object.assign(b,e)}},W="https://explorer-api.walletconnect.com";function D(e){const t=Object.fromEntries(Object.entries(e).filter(([n,a])=>typeof a<"u"&&a!==null&&a!=="").map(([n,a])=>[n,a.toString()]));return new URLSearchParams(t).toString()}const I={async fetchWallets(e,t){const n=D(t),a=`${W}/v3/wallets?projectId=${e}&${n}`;return(await fetch(a)).json()},formatImageUrl(e,t){return`${W}/v3/logo/lg/${t}?projectId=${e}`}},h=u({wallets:{listings:[],total:0,page:1},search:{listings:[],total:0,page:1},previewWallets:[],recomendedWallets:[]});function y(){const{projectId:e}=S.state;if(!e)throw new Error("projectId is required to work with explorer api");return e}const _={state:h,async getPreviewWallets(e){const{listings:t}=await I.fetchWallets(y(),e);return h.previewWallets=Object.values(t),h.previewWallets},async getRecomendedWallets(){const{listings:e}=await I.fetchWallets(y(),{page:1,entries:6});h.recomendedWallets=Object.values(e)},async getPaginatedWallets(e){const{page:t,search:n}=e,{listings:a,total:l}=await I.fetchWallets(y(),e),c=Object.values(a),v=n?"search":"wallets";return h[v]={listings:[...h[v].listings,...c],total:l,page:t??1},{listings:c,total:l}},getImageUrl(e){return I.formatImageUrl(y(),e)},resetSearch(){h.search={listings:[],total:0,page:1}}},r=u({history:["ConnectWallet"],view:"ConnectWallet",data:void 0}),g={state:r,subscribe(e){return f(r,()=>e(r))},push(e,t){e!==r.view&&(r.view=e,t&&(r.data=t),r.history.push(e))},replace(e){r.view=e,r.history=[e]},goBack(){if(r.history.length>1){r.history.pop();const[e]=r.history.slice(-1);r.view=e}}},m=u({open:!1}),x={state:m,subscribe(e){return f(m,()=>e(m))},async open(e){return new Promise(t=>{const{isStandalone:n,isUiLoaded:a,isDataLoaded:l}=i.state,{isConnected:c}=A.state,{enableNetworkView:v}=S.state;if(n?(i.setStandaloneUri(e?.uri),i.setStandaloneChains(e?.standaloneChains),g.replace("ConnectWallet")):e!=null&&e.route?g.replace(e.route):c?g.replace("Account"):v?g.replace("SelectNetwork"):g.replace("ConnectWallet"),a&&l)m.open=!0,t();else{const N=setInterval(()=>{i.state.isUiLoaded&&i.state.isDataLoaded&&(clearInterval(N),m.open=!0,t())},200)}})},close(){m.open=!1}};var P=Object.defineProperty,E=Object.getOwnPropertySymbols,j=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable,O=(e,t,n)=>t in e?P(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,M=(e,t)=>{for(var n in t||(t={}))j.call(t,n)&&O(e,n,t[n]);if(E)for(var n of E(t))k.call(t,n)&&O(e,n,t[n]);return e};function $(){return typeof matchMedia<"u"&&matchMedia("(prefers-color-scheme: dark)").matches}const w=u({themeMode:$()?"dark":"light"}),B={state:w,subscribe(e){return f(w,()=>e(w))},setThemeConfig(e){const{themeMode:t,themeVariables:n}=e;t&&(w.themeMode=t),n&&(w.themeVariables=M({},n))}},C=u({open:!1,message:"",variant:"success"}),H={state:C,subscribe(e){return f(C,()=>e(C))},openToast(e,t){C.open=!0,C.message=e,C.variant=t},closeToast(){C.open=!1}};typeof window<"u"&&(window.Buffer||(window.Buffer=U),window.global||(window.global=window),window.process||(window.process={env:{}}));export{A as AccountCtrl,p as ClientCtrl,S as ConfigCtrl,d as CoreUtil,_ as ExplorerCtrl,x as ModalCtrl,i as OptionsCtrl,g as RouterCtrl,B as ThemeCtrl,H as ToastCtrl};
//# sourceMappingURL=index.js.map
